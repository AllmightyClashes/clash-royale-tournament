<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Clash Royale Tournament â€“ Registrazione</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- FIREBASE -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      query,
      where
    } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    /* ===== CONFIG FIREBASE ===== */
    const firebaseConfig = {
      apiKey: "AIzaSyBUjtbuQfc2drjqivgoLFEyQ9k4Un4f6fQ",
      authDomain: "allmighty-tournaments.firebaseapp.com",
      projectId: "allmighty-tournaments",
      storageBucket: "allmighty-tournaments.firebasestorage.app",
      messagingSenderId: "876830337732",
      appId: "1:876830337732:web:12509e3197a65e6350b791"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let players = [];

    /* ===== REGISTRA GIOCATORE ===== */
    window.registerPlayer = async () => {
      if (players.length >= 1024) {
        alert("Iscrizioni chiuse");
        return;
      }

      const nick = nickname.value.trim();
      const tag = playerTag.value.trim();
      const discord = discordUser.value.trim();

      if (!nick || !tag || !discord) {
        alert("Compila tutti i campi");
        return;
      }

      const q = query(collection(db, "players"), where("discord", "==", discord));
      const snap = await getDocs(q);

      if (!snap.empty) {
        alert("Discord giÃ  registrato");
        return;
      }

      await addDoc(collection(db, "players"), {
        nick,
        tag,
        discord,
        createdAt: Date.now()
      });

      nickname.value = "";
      playerTag.value = "";
      discordUser.value = "";

      loadPlayers();
      alert("Registrazione completata");
    };

    /* ===== CARICA GIOCATORI ===== */
    window.loadPlayers = async () => {
      players = [];
      const snap = await getDocs(collection(db, "players"));

      snap.forEach(d => players.push(d.data()));

      totalPlayers.textContent = players.length;
      playerList.innerHTML = "";

      players.forEach(p => {
        const li = document.createElement("li");
        li.textContent = `${p.nick} (${p.discord})`;
        playerList.appendChild(li);
      });
    };

    window.onload = loadPlayers;
  </script>
</head>

<body class="bg-gray-900 text-white p-6">

<div class="max-w-4xl mx-auto space-y-6">

  <!-- REGISTRAZIONE -->
  <div class="bg-gray-800 p-6 rounded-xl">
    <h2 class="text-xl font-bold mb-4">ðŸŽ® Iscrizione Torneo</h2>

    <input id="nickname" class="w-full mb-2 p-2 bg-gray-700 rounded" placeholder="Nickname">
    <input id="playerTag" class="w-full mb-2 p-2 bg-gray-700 rounded" placeholder="Player Tag">
    <input id="discordUser" class="w-full mb-4 p-2 bg-gray-700 rounded" placeholder="Discord username">

    <button onclick="registerPlayer()"
      class="w-full bg-yellow-500 text-black p-2 rounded font-bold">
      Iscriviti
    </button>
  </div>

  <!-- LISTA GIOCATORI -->
  <div class="bg-gray-800 p-6 rounded-xl">
    <h2 class="text-xl font-bold mb-2">ðŸ“‹ Giocatori iscritti</h2>
    <p class="mb-2">Totale: <span id="totalPlayers">0</span> / 1024</p>

    <ul id="playerList" class="max-h-72 overflow-y-auto text-sm space-y-1"></ul>
  </div>

</div>

</body>
</html>
